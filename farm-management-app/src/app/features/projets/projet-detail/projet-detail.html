<div class="projet-detail-container">

  <!-- ========== LOADING STATE ========== -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="card">
      <div class="loading-spinner"></div>
      <p>Chargement des dÃ©tails du projet...</p>
    </div>
  </div>

  <!-- ========== ERROR MESSAGE ========== -->
  <div *ngIf="errorMessage && !isLoading" class="error-banner">
    <div class="error-content">
      <span class="error-icon">âš ï¸</span>
      <span>{{ errorMessage }}</span>
    </div>
    <button class="btn-secondary" (click)="goBack()">
      â† Retour au Dashboard
    </button>
  </div>

  <!-- ========== CONTENT ========== -->
  <div *ngIf="!isLoading && projet" class="detail-content">

    <!-- ========== HEADER ACTIONS ========== -->
    <div class="detail-header">
      <button class="btn-back" (click)="goBack()">
        â† Retour
      </button>

      <div class="header-actions" *ngIf="hasRole('ADMIN')">
        <button class="btn-secondary" (click)="editProjet()">
          âœï¸ Modifier
        </button>
        <button class="btn-danger" (click)="deleteProjet()">
          ğŸ—‘ï¸ Supprimer
        </button>
      </div>
    </div>

    <!-- ========== PROJET INFO CARD ========== -->
    <div class="card projet-info-card">
      <div class="projet-header-detail">
        <div class="projet-title-section">
          <h1 class="projet-name">{{ projet.nom }}</h1>
          <span
            class="projet-status-badge"
            [ngClass]="getStatutColor(projet.statut)">
            {{ getStatutIcon(projet.statut) }} {{ getStatutLabel(projet.statut) }}
          </span>
        </div>
      </div>

      <div class="projet-details-grid">
        <!-- Description -->
        <div class="detail-block full-width">
          <h3 class="detail-label">ğŸ“ Description</h3>
          <p class="detail-value description-text">
            {{ projet.description || 'Aucune description disponible' }}
          </p>
        </div>

        <!-- Type de Culture -->
        <div class="detail-block">
          <h3 class="detail-label">ğŸŒ± Type de Culture</h3>
          <p class="detail-value">{{ projet.typeCulture }}</p>
        </div>

        <!-- ID Projet -->
        <div class="detail-block">
          <h3 class="detail-label">ğŸ”¢ ID Projet</h3>
          <p class="detail-value">#{{ projet.idProjet }}</p>
        </div>

        <!-- Date de DÃ©but -->
        <div class="detail-block">
          <h3 class="detail-label">ğŸ“… Date de DÃ©but</h3>
          <p class="detail-value">{{ projet.dateDebut | date: 'dd/MM/yyyy' }}</p>
        </div>

        <!-- Date de Fin -->
        <div class="detail-block">
          <h3 class="detail-label">ğŸ“… Date de Fin</h3>
          <p class="detail-value">{{ projet.dateFin | date: 'dd/MM/yyyy' }}</p>
        </div>
      </div>
    </div>

    <!-- ========== STATISTIQUES ========== -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-content">
          <p class="stat-label">Biologistes</p>
          <p class="stat-value">{{ projet.affectations.length || 0 }}</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ğŸ“†</div>
        <div class="stat-content">
          <p class="stat-label">DurÃ©e</p>
          <p class="stat-value">
            {{ calculateDuration(projet.dateDebut, projet.dateFin) }} jours
          </p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">â±ï¸</div>
        <div class="stat-content">
          <p class="stat-label">Statut</p>
          <p class="stat-value">{{ getStatutLabel(projet.statut) }}</p>
        </div>
      </div>
    </div>

    <!-- ========== Ã‰QUIPE SECTION ========== -->
    <div class="card equipe-section">
      <div class="section-header">
        <h2 class="section-title">
          <span class="title-icon">ğŸ‘¥</span>
          Ã‰quipe du Projet
        </h2>
        <button
          *ngIf="hasRole('ADMIN')"
          class="btn-primary"
          (click)="openAssignModal()">
          â• Affecter un Biologiste
        </button>
      </div>

      <!-- Empty State -->
      <div *ngIf="!projet.affectations || projet.affectations.length === 0" class="empty-state">
        <div class="empty-icon">ğŸ‘¤</div>
        <p class="empty-text">Aucun biologiste affectÃ© Ã  ce projet</p>
        <button
          *ngIf="hasRole('ADMIN')"
          class="btn-primary"
          (click)="openAssignModal()">
          Affecter le premier biologiste
        </button>
      </div>

      <!-- Liste des Biologistes -->
      <div *ngIf="projet.affectations && projet.affectations.length > 0" class="biologistes-grid">
        <div
          *ngFor="let biologiste of projet.affectations"
          class="biologiste-card">

          <!-- Avatar -->
          <div class="biologiste-avatar">
            {{ getInitials(biologiste.nom) }}
          </div>

          <!-- Informations -->
          <div class="biologiste-info">
            <h3 class="biologiste-name">{{ biologiste.nom }}</h3>

            <div class="biologiste-details">
              <div class="biologiste-detail-item" *ngIf="biologiste.specialite">
                <span class="detail-icon">ğŸ”¬</span>
                <span class="detail-text">{{ biologiste.specialite }}</span>
              </div>

              <div class="biologiste-detail-item">
                <span class="detail-icon">ğŸ“…</span>
                <span class="detail-text">
                  AffectÃ© {{ getTimeSinceAffectation(biologiste.dateAffectation) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- ========== MODAL D'AFFECTATION ========== -->
  <app-assign-biologiste-modal
    [projetId]="projetId"
    [isOpen]="isAssignModalOpen"
    (close)="closeAssignModal()"
    (success)="onAssignSuccess()">
  </app-assign-biologiste-modal>

</div>
